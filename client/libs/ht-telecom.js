!function(n,V){"use strict";var y=ht.AlarmSeverity=function(m,B,E,t,j){this.value=m,this.name=B,this.nickName=E,this.color=t,this.displayName=j};ht.Default.def("ht.AlarmSeverity",V,{toString:function(){return this.displayName||this.name}}),function(){y.severities=new ht.List,y._vm={},y._nm={},y._cp=function(K,G){if(K&&G){var x=K.value-G.value;return x>0?1:0>x?-1:0}return K&&!G?1:!K&&G?-1:0},y.each=function(S,w){y.severities.each(S,w)},y.getSortFunction=function(){return y._cp},y.setSortFunction=function(Z){y._cp=Z,y.severities.sort(Z)},y.add=function(H,X,r,n,T){var v=new y(H,X,r,n,T);return y._vm[H]=v,y._nm[X]=v,y.severities.add(v),y.severities.sort(y._cp),v},y.remove=function(Q){var K=y._nm[Q];return K&&(delete y._nm[Q],delete y._vm[K.value],y.severities.remove(K)),K},y.CRITICAL=y.add(500,"Critical","C","#FF0000"),y.MAJOR=y.add(400,"Major","M","#FFA000"),y.MINOR=y.add(300,"Minor","m","#FFFF00"),y.WARNING=y.add(200,"Warning","W","#00FFFF"),y.INDETERMINATE=y.add(100,"Indeterminate","N","#C800FF"),y.CLEARED=y.add(0,"Cleared","R","#00FF00"),y.isClearedAlarmSeverity=function(F){return F?0===F.value:!1},y.getByName=function(q){return y._nm[q]},y.getByValue=function(E){return y._vm[E]},y.clear=function(){y.severities.clear(),y._vm={},y._nm={}},y.compare=function(B,C){return y._cp(B,C)}}();var g=ht.AlarmState=function(v){this._d=v,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",V,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var X=null;for(var Y in this._am)Y=y.getByName(Y),y.isClearedAlarmSeverity(Y)||0!==this.getAcknowledgedAlarmCount(Y)&&(X=X?y.compare(X,Y)>0?X:Y:Y);this._haa=X},_c2:function(){var G=null;for(var R in this._nm)R=y.getByName(R),y.isClearedAlarmSeverity(R)||0!==this.getNewAlarmCount(R)&&(G=G?y.compare(G,R)>0?G:R:R);this._hna=G},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var O in this._nm)if(O=y.getByName(O),!y.isClearedAlarmSeverity(O)&&0!==this.getNewAlarmCount(O)&&y.compare(this._hna,O)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var X=this._haa,n=this._hna,S=this._ps;this._hoa=X,y.compare(n,this._hoa)>0&&(this._hoa=n),y.compare(S,this._hoa)>0&&(this._hoa=S)},_c5:function(){var E=this._haa,N=this._hna;this._hta=E,y.compare(N,this._hta)>0&&(this._hta=N)},increaseAcknowledgedAlarm:function(X,x){if(0!==x){x=x||1;var k=this._am[X.name]||0;k+=x,this._am[X.name]=k,this._f()}},increaseNewAlarm:function(A,I){if(0!==I){I=I||1;var w=this._nm[A.name]||0;w+=I,this._nm[A.name]=w,this._f()}},decreaseAcknowledgedAlarm:function(l,m){if(0!==m){m||(m=1);var q=this._am[l.name]||0;if(q-=m,0>q)throw"Alarm count can not be negative";this._am[l.name]=q,this._f()}},decreaseNewAlarm:function(V,$){if(0!==$){$||($=1);var J=this._nm[V.name]||0;if(J-=$,0>J)throw"Alarm count can not be negative";this._nm[V.name]=J,this._f()}},acknowledgeAlarm:function(L){this.decreaseNewAlarm(L,1),this.increaseAcknowledgedAlarm(L,1)},acknowledgeAllAlarms:function(n){if(n){var c=this.getNewAlarmCount(n);this.decreaseNewAlarm(n,c),this.increaseAcknowledgedAlarm(n,c)}else for(var h in this._nm)this.acknowledgeAllAlarms(y.getByName(h))},_c6:function(){this._aac=0;for(var q in this._am)q=y.getByName(q),this._aac+=this.getAcknowledgedAlarmCount(q)},getAcknowledgedAlarmCount:function(s){return s?this._am[s.name]||0:this._aac},getAlarmCount:function(M){return this.getAcknowledgedAlarmCount(M)+this.getNewAlarmCount(M)},_c7:function(){this._nac=0;for(var j in this._nm)this._nac+=this.getNewAlarmCount(y.getByName(j))},getNewAlarmCount:function(A){return A?this._nm[A.name]||0:this._nac},setNewAlarmCount:function(u,_){this._nm[u.name]=_,this._f()},removeAllNewAlarms:function(R){R?delete this._nm[R]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(n,t){this._am[n.name]=t,this._f()},removeAllAcknowledgedAlarms:function(q){q?delete this._am[q.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(p){if(this._ep||(p=null),this._ps!==p){var o=this._ps;this._ps=p,this._f(),this._d.fp("propagateSeverity",o,p)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(I){var a=this._ep;this._ep=I,this._d.fp("enablePropagation",a,I)&&(I||this.setPropagateSeverity(null))}});var P=ht.AlarmStatePropagator=function(D){this._dataModel=D,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",V,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(E){this._enable!==E&&(this._enable=E,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(J){this.propagate(J)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(Z){Z.data&&this.propagate(Z.data)},handleDataPropertyChange:function(Z){if("alarmState"===Z.property||"enablePropagation"===Z.property)this.propagate(Z.data);else if("parent"===Z.property){var v=Z.oldValue;v&&this.propagate(v),this.propagate(Z.data)}},propagate:function(R){R&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(R),this._isPropagating=!1)},propagateToTop:function(A){for(this.propagateToParent(null,A);A&&A.getParent();)this.propagateToParent(A,A.getParent()),A=A.getParent()},propagateToParent:function(C,I){var W=null;I.getChildren().each(function(l){var f=l.getAlarmState().getHighestOverallAlarmSeverity();y.compare(f,W)>0&&(W=f)}),I.getAlarmState().setPropagateSeverity(W)}}),ht.AlarmStateStatistics=function(T){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(T)},ht.Default.def("ht.AlarmStateStatistics",V,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(I){var D=this._dataModel;D!==I&&(D&&(D.umd(this.handleDataPropertyChange,this),D.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=I,this.reset(),I.md(this.handleDataPropertyChange,this),I.mm(this.handleDataModelChange,this),this.fp("dataModel",D,I))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(k){"alarmState"===k.property&&(this.increase(k.data),this.fireAlarmStateChange())},handleDataModelChange:function(n){"add"===n.kind?(this.increase(n.data),this.fireAlarmStateChange()):"remove"===n.kind?(this.decrease(n.data),this.fireAlarmStateChange()):"clear"===n.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,y.each(function(N){var e=this.getSumInfo(N);this.sumAcked+=e.ackedCount,this.sumNew+=e.newCount,this.sumTotal+=e.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(g){if(!g)return this.sumNew;var T=this.getSumInfo(g);return T.newCount},getAcknowledgedAlarmCount:function(X){if(!X)return this.sumAcked;var m=this.getSumInfo(X);return m.ackedCount},getTotalAlarmCount:function(f){if(!f)return this.sumTotal;var $=this.getSumInfo(f);return $.totalCount},getSumInfo:function(y){var U=this.severtiyMap[y.name];return U||(U={},U.newCount=0,U.ackedCount=0,U.totalCount=0,this.severtiyMap[y.name]=U),U},decrease:function(H){var g=this.dataMap[H.getId()];g&&(delete this.dataMap[H.getId()],y.each(function(C){var X=g[C.name],$=this.getSumInfo(C);$.newCount=$.newCount-X.newCount,$.ackedCount=$.ackedCount-X.ackedCount,$.totalCount=$.totalCount-X.totalCount},this))},increase:function(s){if(this.decrease(s),!this._filterFunc||this._filterFunc(s)){var F={},U=s.getAlarmState();this.dataMap[s.getId()]=F,y.each(function(P){var k={};k.newCount=U.getNewAlarmCount(P),k.ackedCount=U.getAcknowledgedAlarmCount(P),k.totalCount=U.getAlarmCount(P),F[P.name]=k;var A=this.getSumInfo(P);A.newCount=A.newCount+k.newCount,A.ackedCount=A.ackedCount+k.ackedCount,A.totalCount=A.totalCount+k.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(p){var $=this._filterFunc;this._filterFunc=p,this.reset(),this.fp("filterFunc",$,p)},getFilterFunc:function(){return this._filterFunc}});var o=ht.Data.prototype;o.getAlarmState=function(){return this._alarmState||(this._alarmState=new g(this))},o=ht.DataModel.prototype,o.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},o.setEnableAlarmStatePropagator=function(I){I!=this.isEnableAlarmStatePropagator()&&(I?(this._alarmStatePropagator=new P(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},o=ht.graph.GraphView.prototype,o.getNote2=function(d){var $=d.getAlarmState().getHighestNewAlarmSeverity();if($){var C=d.getAlarmState().getNewAlarmCount($)+$.nickName;return d.getAlarmState().hasLessSevereNewAlarms()&&(C+="+"),C}return d.s("note2")},o.getNote2Background=function(I){var C=I.getAlarmState().getHighestNewAlarmSeverity();return C?C.color:I.s("note2.background")},o.getBodyColor=function(P){var X=P.getAlarmState().getHighestNativeAlarmSeverity();return X?X.color:P.s("body.color")},o.getBorderColor=function(A){var V=A.getAlarmState().getPropagateSeverity();return V?V.color:A.s("border.color")},o=ht.widget.TreeView.prototype,o.getBorderColor=function(o){var r=o.getAlarmState().getPropagateSeverity();return r?r.color:o.s("border.color")},o.getIcon=function(P){return P.getIcon()?"__alarmIcon__":null},o=ht.widget.TreeTableView.prototype,o.getBorderColor=function(h){var a=h.getAlarmState().getPropagateSeverity();return a?a.color:h.s("border.color")},o.getIcon=function(O){return O.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(m){return m.getIcon()}},color:{func:function(C){var T=C.getAlarmState().getHighestNativeAlarmSeverity();return T?T.color:C.s("body.color")}},rect:[0,0,16,16]}]});var M=ht.Style;M["note2.expanded"]=!0,M["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);