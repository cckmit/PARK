!function(w,x,r){"use strict";var k=w.ht;k.Astar={},function(F){var A=F();w.AStar=A.astar,w.AStar.Graph=A.Graph}(function(){function t(h){for(var j=h,m=[];j.parent;)m.unshift(j),j=j.parent;return m}function u(){return new z(function(s){return s.f})}function f(N,I){I=I||{},this.nodes=[],this.diagonal=!!I.diagonal,this.grid=[];for(var F=0;F<N.length;F++){this.grid[F]=[];for(var w=0,v=N[F];w<v.length;w++){var p=new L(F,w,v[w]);this.grid[F][w]=p,this.nodes.push(p)}}this.$13x()}function L(G,v,T){this.x=G,this.y=v,this.weight=T}function z(F){this.content=[],this.scoreFunction=F}var Q={search:function(i,U,p,o){i.$6x(),o=o||{};var n=o.heuristic;n||(n=i.diagonal?Q.$4x.diagonal:Q.$4x.manhattan);var j=o.closest||!1,y=o.punish,P=u(),Z=U;for(U.h=n(U,p),i.$7x(U),P.push(U);P.size()>0;){var B=P.pop();if(B===p)return t(B);B.closed=!0;for(var G=i.neighbors(B),E=0,V=G.length;V>E;++E){var D=G[E];if(!D.closed&&!D.$9x()){var m=B.g+D.getCost(B,y),X=D.visited;(!X||m<D.g)&&(D.visited=!0,D.parent=B,D.h=D.h||n(D,p),D.g=m,D.f=D.g+D.h,i.$7x(D),j&&(D.h<Z.h||D.h===Z.h&&D.g<Z.g)&&(Z=D),X?P.$10x(D):P.push(D))}}}return j?t(Z):[]},$4x:{manhattan:function(H,Y){var F=Math.abs(Y.x-H.x),S=Math.abs(Y.y-H.y);return F+S},diagonal:function(v,S){var G=1,y=Math.sqrt(2),M=Math.abs(S.x-v.x),F=Math.abs(S.y-v.y);return G*(M+F)+(y-2*G)*Math.min(M,F)}},$5x:function(F){F.f=0,F.g=0,F.h=0,F.visited=!1,F.closed=!1,F.parent=null}};return f.prototype.$13x=function(){this.dirtyNodes=[];for(var c=0;c<this.nodes.length;c++)Q.$5x(this.nodes[c])},f.prototype.$6x=function(){for(var a=0;a<this.dirtyNodes.length;a++)Q.$5x(this.dirtyNodes[a]);this.dirtyNodes=[]},f.prototype.$7x=function(D){this.dirtyNodes.push(D)},f.prototype.neighbors=function(s){var f=[],G=s.x,V=s.y,P=this.grid;return P[G-1]&&P[G-1][V]&&f.push(P[G-1][V]),P[G+1]&&P[G+1][V]&&f.push(P[G+1][V]),P[G]&&P[G][V-1]&&f.push(P[G][V-1]),P[G]&&P[G][V+1]&&f.push(P[G][V+1]),this.diagonal&&(P[G-1]&&P[G-1][V-1]&&f.push(P[G-1][V-1]),P[G+1]&&P[G+1][V-1]&&f.push(P[G+1][V-1]),P[G-1]&&P[G-1][V+1]&&f.push(P[G-1][V+1]),P[G+1]&&P[G+1][V+1]&&f.push(P[G+1][V+1])),f},f.prototype.toString=function(){for(var i=[],D=this.grid,d=0;d<D.length;d++){for(var q=[],V=D[d],R=0;R<V.length;R++)q.push(V[R].weight);i.push(q.join(" "))}return i.join("\n")},L.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},L.prototype.getCost=function(d,A){var M;if(M=d&&d.x!=this.x&&d.y!=this.y?1.41421*this.weight:this.weight,A){var P=d;if(!P)return M;var e=P.parent;return e?Math.abs(e.x+this.x-2*P.x)>1e-5?M+A:Math.abs(e.y+this.y-2*P.y)>1e-5?M+A:M:M}},L.prototype.$9x=function(){return 0===this.weight},z.prototype={push:function(j){this.content.push(j),this.$11x(this.content.length-1)},pop:function(){var J=this.content[0],I=this.content.pop();return this.content.length>0&&(this.content[0]=I,this.$12x(0)),J},remove:function(h){var $=this.content.indexOf(h),Z=this.content.pop();$!==this.content.length-1&&(this.content[$]=Z,this.scoreFunction(Z)<this.scoreFunction(h)?this.$11x($):this.$12x($))},size:function(){return this.content.length},$10x:function(t){this.$11x(this.content.indexOf(t))},$11x:function(C){for(var V=this.content[C];C>0;){var j=(C+1>>1)-1,U=this.content[j];if(!(this.scoreFunction(V)<this.scoreFunction(U)))break;this.content[j]=V,this.content[C]=U,C=j}},$12x:function(l){for(var H=this.content.length,$=this.content[l],N=this.scoreFunction($);;){var b,m=l+1<<1,E=m-1,I=null;if(H>E){var C=this.content[E];b=this.scoreFunction(C),N>b&&(I=E)}if(H>m){var P=this.content[m],f=this.scoreFunction(P);(null===I?N:b)>f&&(I=m)}if(null===I)break;this.content[l]=this.content[I],this.content[I]=$,l=I}}},{astar:Q,Graph:f}});var i=k.Astar.Finder=function(n,S){var k=this;k.gv=n,k.$13x(S),k.refreshMap()};i.prototype={},i.prototype.constructor=i,x.defineProperties(i.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(o){this.gv._astarDebugInfo=o}}}),i.prototype.$13x=function(j){var z=this,d=z.$14x={};j=j||{};var y=j.gridSize||10;d.gridSizeX=j.gridSizeX||y,d.gridSizeY=j.gridSizeY||y,d.rect=j.rect,d.filter=j.filter,d.extendBlocks=j.extendBlocks||3,d.fastOverlap=j.fastOverlap===r?!0:j.fastOverlap,d.nodeRectExtend=j.nodeRectExtend||0,d.diagonal=j.diagonal===r?!0:j.diagonal,d.turnPunish=j.turnPunish===r?.1:j.turnPunish,d.simplify=j.simplify===r?!0:j.simplify,d.toGridCenter=j.toGridCenter===r?!1:j.toGridCenter,d.closest=j.closest===r?!0:j.closest},i.prototype.refreshMap=function(){var Y,M=this,B=M.$14x,q=B.gridSizeX,C=B.gridSizeY,u=B.extendBlocks;B.rect?Y=B.rect:(Y=M.$15x(),k.Default.grow(Y,q*u,C*u)),k.Default.grow(Y,q,C);var R=Math.floor(Y.x/q)*q,A=Math.floor(Y.y/C)*C,K=Math.ceil(Y.width/q),l=Math.ceil(Y.height/C),$=K*q,F=l*C;M.$16x={x:R,y:A,w:$,h:F,gridX:q,gridY:C,xLen:K,yLen:l},M.$17x(),M.$21x()},i.prototype.$15x=function(){var H=this.gv;if(H instanceof k.graph.GraphView)return H.getContentRect();var V,D=k.Default.unionRect;return H.dm().each(function(I){H.isVisible(I)&&I.getRect&&(V=D(V,I.getRect()))}),V},i.prototype.$17x=function(){var V,K,p,S,D=this,_=D.$16x,Y=_.xLen,b=_.yLen;for(V=new Array(Y),p=0;Y>p;p++)for(V[p]=K=new Array(b),S=b;S--;)K[S]=1;var T=D.$14x.filter;for(D.gv.dm().each(function(Z){T&&T(Z)===!1||(!D._debugInfo||Z!==D._debugInfo.grid&&Z!=D._debugInfo.path)&&D.$1cw(V,Z)}),p=0;Y>p;p++)V[p][0]=1,V[p][b-1]=1;for(S=0;b>S;S++)V[0][S]=1,V[Y-1][S]=1;D.grid=V;var O=new AStar.Graph(V,{diagonal:D.$14x.diagonal});D.graph=O},i.prototype.$18x=function(s,w,V,b,z,D,H,Q){var d=this.$19x,q=d(V-s,z-H,b-w,D-Q);if(1e-6>=q&&q>=-1e-6)return!1;var N=d(z-s,z-H,D-w,D-Q)/q;if(0>N||N>1)return!1;var R=d(V-s,z-s,b-w,D-w)/q;return 0>R||R>1?!1:!0},i.prototype.$19x=function(I,Y,h,X){return I*X-Y*h},i.prototype.$1aw=function(J,m,H,Y){for(var M=[-(m[1]-J[1]),m[0]-J[0]],Q=M[0]*(H[0]-J[0])+M[1]*(H[1]-J[1])>=0,e=0,c=Y.length;c>e;e+=2)if(M[0]*(Y[e]-J[0])+M[1]*(Y[e+1]-J[1])>=0===Q)return!1;return!0},i.prototype.$1bw=function(k,l){for(var W,x,Y=this,v=0,h=k.length;h>v;v+=2)if(W=v===h-2?0:v+2,x=W===h-2?0:W+2,Y.$1aw([k[v],k[v+1]],[k[W],k[W+1]],[k[x],k[x+1]],l))return!1;for(var v=0,h=l.length;h>v;v+=2)if(W=v===h-2?0:v+2,x=W===h-2?0:W+2,Y.$1aw([l[v],l[v+1]],[l[W],l[W+1]],[l[x],l[x+1]],k))return!1;return!0},i.prototype.$1cw=function(X,W){if(W.getRect){var c=this,C=W.getRect();k.Default.grow(C,c.$14x.nodeRectExtend);var s,j,g,P,K,B,Q,z,m,y,Y,v=c.$1dw({x:C.x,y:C.y}),Z=c.$1dw({x:C.x+C.width,y:C.y+C.height}),x=c.$14x.fastOverlap;if(!x){var f=W.getCorners();Q=[],f.forEach(function(F){Q.push(F.x,F.y)}),y=c.$14x.gridSizeX/2,Y=c.$14x.gridSizeY/2}for(j=Math.max(0,v.x),g=Math.min(Z.x,X.length-1),K=Math.max(0,v.y),B=Math.min(Z.y,X.length?X[0].length-1:-1),s=j;g>=s;s++)for(P=K;B>=P;P++)if(x)X[s][P]=0;else{m=c.$1ew({x:s,y:P});var H=m.x-y,T=m.x+y,L=m.y-Y,w=m.y+Y;z=[H,L,H,w,T,w,T,L],c.$1bw(Q,z)&&(X[s][P]=0)}}},i.prototype.$1dw=function(i,O){var e=this,t=e.$16x,P=(i.x-t.x)/t.gridX,m=(i.y-t.y)/t.gridY;return O!==!1&&(P=Math.round(P),m=Math.round(m)),{x:P,y:m}},i.prototype.$1ew=function(S){var f=this,E=f.$16x;return{x:S.x*E.gridX+E.x,y:S.y*E.gridY+E.y}},i.prototype.$1fw=function(j){var T=this,U=T.$16x,X=U.xLen,G=U.yLen;if(j.x>=0&&j.x<X&&j.y>=0&&j.y<G)return j;var K={x:j.x,y:j.y};return K.x<0?K.x=0:K.x>=X&&(K.x=X-1),K.y<0?K.y=0:K.y>=G&&(K.y=G-1),K},i.prototype.findPath=function(c,m){var F,z,B,G,d=this,e=d.$1dw(c),E=d.$1dw(m);if(B=d.$1fw(e),G=d.$1fw(E),B!==e&&G!==E){var j=d.$16x,O=j.x-j.gridX/2,I=j.y-j.gridY/2,N=O+j.gridX*j.xLen,Z=I+j.gridY*j.yLen;if(!(d.$18x(c.x,c.y,m.x,m.y,O,I,N,I)||d.$18x(c.x,c.y,m.x,m.y,N,I,N,Z)||d.$18x(c.x,c.y,m.x,m.y,N,Z,O,Z)||d.$18x(c.x,c.y,m.x,m.y,O,Z,O,I)))return[c,m]}B!==e&&(F=!0,e=B),G!==E&&(z=!0,E=G);var k=d.graph.grid[e.x][e.y],s=d.graph.grid[E.x][E.y],f=AStar.search(d.graph,k,s,{closest:d.$14x.closest,punish:d.$14x.turnPunish});if(!f||!f.length)return null;var p=[];p.push(c),F&&p.push(d.$1ew(f[0]));for(var h=1,V=f.length;V-1>h;h++)p.push(d.$1ew(f[h]));if(z)p.push(d.$1ew(f[V-1])),p.push(m);else{var w=f[V-1];E.x!==w.x||E.y!==w.y||d.$14x.toGridCenter?p.push(d.$1ew(w)):p.push(m)}return d.$14x.simplify&&(p=d.simplifyPath(p)),d.$20x=p,d.$21x(),p},i.prototype.debugOn=function(n){this.debugFlag=!0,this.debugSettings=n||{},this.$21x()},i.prototype.simplifyPath=function(M){var S=M.length;if(2>=S)return M;var n,o,k=[M[0],M[1]],b=k[0],z=k[1],a=1e-5;for(n=2;S>n;n++)o=M[n],Math.abs((z.x-b.x)*(o.y-b.y)-(z.y-b.y)*(o.x-b.x))<a?z=k[k.length-1]=o:(b=z,z=o,k.push(o));return k},i.prototype.$21x=function(){var s=this;if(s.$22x(),this.debugFlag){var b=s.grid;if(b){var M,A=s.gv;if(s.debugSettings.$16x!==!1){M=[];for(var o,S,$,x,_,e=[],G=s.$14x.gridSizeX/2,t=s.$14x.gridSizeY/2,i=b.length,H=i?b[0].length:0,I=1;i-1>I;I++)for(var F=1;H-1>F;F++)b[I][F]||(o=s.$1ew({x:I,y:F}),S=o.x-G,$=o.x+G,x=o.y-t,_=o.y+t,M.push({x:S,y:x},{x:S,y:_},{x:$,y:_},{x:$,y:x}),e.push(1,2,2,2,5));var z=new k.Shape;z.s("shape.border.color","rgba(50, 50, 50, 0.2)"),z.s("shape.border.width",1),z.s("shape.background","rgba(200, 50, 100, 0.2)"),z.s("2d.editable",!1),z.s("2d.selectable",!1),z.setPoints(M),z.setSegments(e),s._debugInfo={grid:z},A.dm().add(z)}s.debugSettings.path!==!1&&(M=new k.Shape,s.$20x&&(M.setPoints(s.$20x),M.s("shape.border.color","red"),M.s("shape.border.width",1),M.s("2d.editable",!1),M.s("2d.selectable",!1),M.s("shape.background",null),s._debugInfo||(s._debugInfo={}),s._debugInfo.path=M,A.dm().add(M)))}}},i.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},i.prototype.$22x=function(){var h=this;if(h._debugInfo){var H=h._debugInfo.grid,E=h._debugInfo.path,F=h.gv;H&&F.dm().remove(H),E&&F.dm().remove(E),h._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);